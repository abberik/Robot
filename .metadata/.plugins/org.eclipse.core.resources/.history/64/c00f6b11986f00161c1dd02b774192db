package handelser;

import java.awt.event.ActionEvent;
import java.beans.PropertyChangeListener;

import javax.swing.Action;

import client.Konsol;
import natverkssaker.Anslutning;
import natverkssaker.Message;

public class KonsolEntered implements Action{
	
	private Anslutning anslutning;
	private Konsol konsol;
	
	public KonsolEntered(Konsol konsol) {
		this.konsol = konsol;
		konsol.getFalt().setAction(this);
		this.setEnabled(true);
	}
	
	@Override
	public void actionPerformed(ActionEvent e) {
		
		//hamta texten fran konsollen
		String raw = konsol.getFalt().getText();
		String[] inData = raw.split(" ");
		konsol.getFalt().setText("");
		
		//analysera
		if(inData[0].equals("drive"))	drive(raw);
		if(inData[0].equals("rotate")) rotate(raw);
		
	}
	

	@Override
	public void addPropertyChangeListener(PropertyChangeListener arg0) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public Object getValue(String arg0) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public boolean isEnabled() {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public void putValue(String arg0, Object arg1) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void removePropertyChangeListener(PropertyChangeListener arg0) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void setEnabled(boolean arg0) {
		// TODO Auto-generated method stub
		
	}
	
	
	
	public Anslutning getAnslutning() {
		return anslutning;
	}

	public void setAnslutning(Anslutning anslutning) {
		this.anslutning = anslutning;
	}

	public Konsol getKonsol() {
		return konsol;
	}

	public void setKonsol(Konsol konsol) {
		this.konsol = konsol;
	}

	public void drive(String raw){
		
		/*
		 * 
		 * Temporarily this method will be used to blink the LED for time just to check everything concerning the network.
		 * 
		 */
		
		if(raw.split(",").length != 1){
			//om ytterligare parametrar gavs
			
			
			boolean timed = false;
			int time = -1;
			
			char[] chars = raw.toCharArray();
			
			boolean in_arg = false;
			char arg_char = '0';
			boolean arg_char_taken = false;
			String arg_args = "";
			
			for(int b = 0; b < chars.length; b++){
				
				if(in_arg && !arg_char_taken){
					arg_char = chars[b];
					arg_char_taken = true;
				}
				
				if(in_arg && arg_char_taken){
					
					arg_args += chars[b];
					
				}
				
				if(chars[b] == '-') in_arg = true;
				
				if(chars[b] == ' ' && in_arg){
					//parse this statement
					if(arg_char != 't'){
						//timad f�rd
						timed = true;
						time = Integer.parseInt(arg_args);
						
					}
				}
				
			}
			
			//Här är alla parametrar klara
			
			anslutning.send(new Message(anslutning.getProtokol().getForward(),time));
		}
		
	}
	
	public void rotate(String raw){
		if(raw.split(",").length != 1){
			//om ytterligare parametrar gavs
			
			
			boolean timed = false;
			int time = -1;
			
			boolean right = false;
			boolean left = false;
			
			char[] chars = raw.toCharArray();
			
			boolean in_arg = false;
			char arg_char = '0';
			boolean arg_char_taken = false;
			String arg_args = "";
			
			for(int b = 0; b < chars.length; b++){
				
				if(in_arg && !arg_char_taken){
					arg_char = chars[b];
					arg_char_taken = true;
				}
				
				if(in_arg && arg_char_taken){
					
					arg_args += chars[b];
					
				}
				
				if(chars[b] == '-') in_arg = true;
				
				if(chars[b] == ' ' && in_arg){
					//parse this statement
					if(arg_char == 't'){
						//timad f�rd
						timed = true;
						time = Integer.parseInt(arg_args);
						
					}else if(arg_char == 'r'){
						
						right = true; left = false;
						
					}else if(arg_char == 'l'){
						
						left = true; right = false;
						
					}
				}
				
			}
			
			
			if(right){				anslutning.send(new Message(anslutning.getProtokol().getRight(),time));			}
			if(left){				anslutning.send(new Message(anslutning.getProtokol().getLeft(),time));			}
			
		}

		
	}

}
